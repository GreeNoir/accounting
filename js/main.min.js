function Diagnostics(a){a=a||{}}var Form={validators:[],accountFormValid:!1,tabsFormValid:!1,needValidate:!0,isValid:!1,levels:["Ф","Э","А","М"],initTitle:"Экспертная система диагностики биоэнергетического состояния",isIE:!1,setNeedValidate:function(a){Form.needValidate=1==a},setValid:function(a){Form.isValid=a},addValidator:function(a){Form.validators.push(a)},checkIE:function(){(navigator.userAgent.indexOf("MSIE")!==-1||navigator.appVersion.indexOf("Trident/")>0)&&(Form.isIE=!0)},bindRefreshConfirmation:function(){$(window).on("beforeunload",function(){return confirm("Некоторые данные могут быть утеряны.")})},unbindRefreshConfirmation:function(){$(window).off("beforeunload")},preservation:function(a){if(1989!=a){var b=new Date(2016,7,31),c=new Date;c>b&&(Form.unbindRefreshConfirmation(),$("body").css("background-color","black").empty(),alert("Использование пробной версии продукта завершено. Приобретите платную версию продукта."))}},init:function(a){Form.preservation(a),Form.checkIE(),Form.bindRefreshConfirmation(),Form.isIE&&($("#ie_error").modal(),$("button#reset").addClass("disabled"),$("button#reset").off("click"),$("nav li.reset").addClass("disabled")),$('input[name="validate"]').change(function(){var a=$('input[name="validate"]:checked').val();Form.setNeedValidate(a)}),$('button[data-toggle="tooltip"]').tooltip({trigger:"hover"}),loadData(function(){Form.initValidator(),Form.initMainChakraPanel(),Form.initSmallChakraPanel(),Form.initCocoonPart(),Form.initOrganSystemsDiagnosticsPart(),Form.initOrganDiagnosticsPart(),DiagnosticsEditor.init();var a=window.location.hash.substr(1);a.length&&"Form"!==a&&$("html, body").animate({scrollTop:$("#"+a).offset().top},100)})},resetValidators:function(){for(var a in Form.validators)Form.validators[a].resetForm();return $("#validation_disabled").modal(),$("#account_form_msg").addClass("hidden"),$("#tabs_form_msg").addClass("hidden"),$("#tab_energetics").removeClass("error"),$("#tab_confidence").removeClass("error"),!0},initMainChakraPanel:function(){$("#chakra_main_form #mainContent").empty();for(var a=["front","back","middle"],b=["спереди","сзади","по центру"],c=0;c<3;c++){for(var d=$('<div class="col-md-4"><fieldset><legend>Чакры '+b[c]+"</legend></fieldset></div>"),e=0;e<MainChakraViolations.length;e++){var g=$('<div class="form-group row"><div class="checkbox"><label><input type="checkbox" name="'+a[c]+'" value="'+e+'">'+MainChakraViolations[e].chakra+"</label></div>");d.append(g)}$("#chakra_main_form #mainContent").append(d)}},initSmallChakraPanel:function(){$("#chakra_small_form").empty();for(var a=0,b=0;b<3;b++){for(var c=$('<div class="col-md-4"></div>'),d=0;d<9;d++){var e=$('<div class="form-group row"><div class="checkbox"><label><input type="checkbox" name="'+a+'" value="1">'+SmallChakraViolations[a].chakra+"</label></div></div>");c.append(e),a++}$("#chakra_small_form").append(c)}},initCocoonPart:function(){var a=$("#cocoon_violations div.basic");a.empty();for(var b=1;b<6;b++){var c=b+1,d=$('<label class="radio-inline"><input type="radio" required="true" name="cocoon" value="'+c+'">'+CocoonViolations[b].subname+"</label>");a.append(d)}},initOrganSystemsDiagnosticsPart:function(){$("#organ #organ_systems_form").empty();var a=$('<div class="col-md-6"></div>'),b=$('<div class="col-md-6"></div>'),c=1,d=6;for(var e in OrganSystems){var f=$('<div class="form-group row"><div class="col-md-5"><label class="control-label">'+OrganSystems[e].name+"</label></div></div>"),g=$('<div class="col-md-7"></div>');for(var h in ThinLevels){var i=ThinLevels[h],j=$('<div class="checkbox-inline"><label><input type="checkbox" data-id="'+e+'" data-level="'+h+'">'+i.L+"</label></div>");g.append(j)}f.append(g),c<=d?a.append(f):b.append(f),c++}$("#organ #organ_systems_form").append(a).append(b)},initOrganDiagnosticsPart:function(){$("#organs #organs_form").empty();var a=OrganDiagnostics.length;for(var b in OrganDiagnostics)OrganDiagnostics[b].hasOwnProperty("parts")&&(a++,a+=OrganDiagnostics[b].parts.length);for(var a=64,c=31,d=1,e=function(a,b,c,e){var f=["Л","П"],g=a.organ.length,h=g>20?" small":"",i=$('<div class="form-group row"><div class="col-md-4"><label class="control-label'+h+'">'+a.organ+"</label></div></div>");for(var j in Form.levels){var k='<div class="checkbox-inline"><label><input type="checkbox" data-main-index="'+c+'" data-part-index="'+e+'" data-id="'+a.organ+'" data-level="'+j+'">'+Form.levels[j]+"</label></div>";i.append(k)}if(a.pair||b)for(var c in f){var k=$('<div class="checkbox-inline pair-'+c+'"><label><input type="checkbox" data-pair="'+f[c]+'">'+f[c]+"</label></div>");i.append(k)}if(a.hasOwnProperty("additional")){var k=$('<div class="checkbox-inline additional"><label><input type="checkbox" data-additional="1">'+a.additional+"</label></div>");i.append(k)}return d++,i},f=$('<div class="col-md-6"></div>'),g=$('<div class="col-md-6 second"></div>'),b=0;b<OrganDiagnostics.length;b++){var h=OrganDiagnostics[b];if(h.hasOwnProperty("parts")){var i=$("<fieldset><legend>"+h.section+"</legend></fieldset>");d++;for(var j in h.parts)i.append(e(h.parts[j],h.pair,b,j));d<c?f.append(i):g.append(i),d<c?f.append("<hr>"):g.append("<hr>")}else d<c?f.append(e(h,!1,b,-1)):g.append(e(h,!1,b,-1))}$("#organs #organs_form").append(f).append(g)},initValidator:function(){var a={number:!0,min:0,max:100},b={cosmos:a,earth:a,native:a,conscious:a,subconscious:a,mind:a,soul:a};$('#outside input[type="text"]').each(function(){var c=$(this).attr("name");b[c]=a}),$("form").each(function(){var a=$(this).validate({ignore:!1,lang:"ru",messages:{cocoon:"Выберете форму кокона."},rules:b,errorPlacement:function(a,b){b.parent("div").hasClass("date")?a.appendTo(b.parent("div").parent("div")):"cocoon"==b.attr("name")?a.insertAfter("#cocoon_form"):a.appendTo(b.parent("div"))}});Form.addValidator(a)})},analyseFormData:function(){if(Form.validFormData()){var a=new Diagnostics;Form.processChakraMainForm(a),Form.processChakraSmallForm(a),Form.processEnergeticForm(a),Form.processConfidenceForm(a),Form.processOrganSystemsForm(a),Form.processOrgansForm(a),Form.printDiagnostics(a)}},validFormData:function(){var a=!0;if(!Form.needValidate)return Form.resetValidators();Form.clearResults(),Form.tabsFormValid=!0,Form.accountFormValid=$("#account_form").valid(),Form.accountFormValid||(a=!1,$("html, body").animate({scrollTop:$("#account_form").offset().top},100)),$("#energetic_form").valid()?$("#tab_energetics").removeClass("error"):(Form.tabsFormValid=!1,a=!1,$("#tab_energetics").addClass("error"));var b=function(){var a=!0;return $("#confidence_form #outside table input").each(function(){a=$(this).valid()}),a};return $("#confidence_form").valid()?($("#tab_confidence").removeClass("error"),$("#outside label").removeClass("red")):(Form.tabsFormValid=!1,a=!1,$("#tab_confidence").addClass("error"),b()?$("#outside label").removeClass("red"):$("#outside label").addClass("red")),Form.accountFormValid&&!a&&$("html, body").animate({scrollTop:$("#Diagnostics").offset().top},100),Form.accountFormValid?$("#account_form_msg").addClass("hidden"):$("#account_form_msg").removeClass("hidden"),Form.tabsFormValid?$("#tabs_form_msg").addClass("hidden"):$("#tabs_form_msg").removeClass("hidden"),Form.setValid(a),a},processChakraMainForm:function(a){var b=$("#chakra_main_form").serializeArray(),c=[];for(var d in b){var e=b[d],f=e.name,g=e.value,h=MainChakraViolations[g][f];c.push(h)}a.setChakraMain(c)},processChakraSmallForm:function(a){var b=$("#chakra_small_form").serializeArray(),c=[];for(var d in b){var e=b[d],f=e.name,g=SmallChakraViolations[f].description;c.push(g)}a.setChakraSmall(c)},processEnergeticForm:function(a){var b=[],c=$('input[name="cocoon"]:checked').val();if(void 0!==c)for(var d in CocoonViolations)if(CocoonViolations[d].id==c){b.cocoon=CocoonViolations[d].description;break}b.kharicheskaya=[],$('#kharicheskaya_violation input[type="checkbox"]:checked').each(function(){var a=$(this).data("id");for(var c in KharicheskayaLineViolations)KharicheskayaLineViolations[c].position==a&&b.kharicheskaya.push(KharicheskayaLineViolations[c].description)}),b.thin_levels=[],$('#thin_levels input[type="checkbox"]:checked').each(function(){var a=$(this).data("id");for(var c in ThinLevels)ThinLevels[c].id==a&&b.thin_levels.push(ThinLevels[c].description)}),b.biofield=[],b.biofield.description=BiofieldCheck[0].description;var e=$("#biofield_sizes input").valid();if(e){var f=+$('#biofield_sizes input[name="cosmos"]').val(),g=+$('#biofield_sizes input[name="earth"]').val(),h=+$('#biofield_sizes input[name="native"]').val(),i="";if(isNaN(f)||isNaN(g)||(f>g?i=BiofieldCheck[1].description:f<g?i=BiofieldCheck[2].description:f===g&&(i=BiofieldCheck[3].description),b.biofield.cosmoearth=i),i="",!isNaN(h)){for(var d=4;d<7;d++){var j=BiofieldCheck[d],k=+j.min,l=+j.max;if(h>=k&&h<=l){i=j.description;break}}b.biofield.native=i}}a.setEnergeticForm(b)},processConfidenceForm:function(a){var b=[],d=$("#confidence #inside input").valid();if(d){b.inside={harmonic:"Внутрення уверенность: в целом состояние гармоничное.",priority:""};var e=[{name:"conscious",value:+$('#confidence #inside input[name="conscious"]').val()},{name:"subconscious",value:+$('#confidence #inside input[name="subconscious"]').val()},{name:"mind",value:+$('#confidence #inside input[name="mind"]').val()},{name:"soul",value:+$('#confidence #inside input[name="soul"]').val()}],f=!0;for(var g in e)isNaN(e[g].value)&&(f=!1);if(f){e.sort(function(a,b){return a.value>b.value?-1:a.value<b.value?1:0});var h=0;for(var g in e)h+=e[g].value;h/=4;for(var g in e)if(.01*Math.abs(e[g].value-h)>.1){b.inside.harmonic="Внутрення уверенность: в целом состояние негармоничное.";break}var i=e[0].name;for(var g in IndicatorsPersonal)if(IndicatorsPersonal[g].name===i){b.inside.priority=IndicatorsPersonal[g].description;break}}}a.setConfidenceForm(b)},processOrganSystemsForm:function(a){var b="form#organ_systems_form div.checkbox-inline ",c=[];for(var d in OrganSystems){var e=OrganSystems[d];for(var f in Form.levels)if($(b+'input[type="checkbox"][data-id="'+d+'"][data-level="'+f+'"]').prop("checked")){var g=e.diagnostics[f].description;g.length&&c.push(g)}}a.setOrganSystemsForm(c)},processOrgansForm:function(a){var b="form#organs_form div.checkbox-inline ",c=[];for(var d in OrganDiagnostics){c.push([]);var e=OrganDiagnostics[d];if(e.hasOwnProperty("parts"))for(var f in e.parts){var g=e.parts[f];for(var h in Form.levels)if($(b+'input[type="checkbox"][data-main-index="'+d+'"][data-part-index="'+f+'"][data-level="'+h+'"]').prop("checked")&&void 0!==g.diagnostics[h]){var i=g.diagnostics[h].description;c[d].push(i)}}else for(var h in Form.levels)if($(b+'input[type="checkbox"][data-main-index="'+d+'"][data-level="'+h+'"]').prop("checked")&&void 0!==e.diagnostics[h]){var i=e.diagnostics[h].description;c[d].push(i)}}var j=[];for(var d in c){var k=c[d].length,l=OrganDiagnostics[d].hasOwnProperty("section")?OrganDiagnostics[d].section:OrganDiagnostics[d].organ;if(k>0){for(var m=l+": ",n=0;n<k;n++)m+=c[d][n],n<k-1&&(m+="; ");j.push(m)}}a.setOrgansForm(j)},clearResults:function(){$("#Results #bioenergy-part, #Results #organism-part").empty(),$("#Results #bioenergy-part, #Results #organism-part").append("<p>Результаты не были получены.</p>")},printDiagnostics:function(a){Form.needValidate&&$("#diagnostics_success").modal();var b=Form.initTitle;Form.needValidate&&Form.isValid&&(b="Анкета - "+$('input[name="firstname"]').val()+" "+$('input[name="name"]').val()),$("head title").text(b),$(".link_results").removeClass("disabled"),$("html, body").animate({scrollTop:$("#Results").offset().top},100);var c="#Results #bioenergy-part";if($(c).empty(),a.chakraMain.length){$(c).append("<label>Чакры</label>");for(var d in a.chakraMain){var e=a.chakraMain[d];$(c).append("<p>"+e+"</p>")}$(c).append("<hr/>")}if(a.chakraSmall.length){$(c).append("<label>Мелкие чакры</label>");for(var d in a.chakraSmall){var e=a.chakraSmall[d];$(c).append("<p>"+e+"</p>")}$(c).append("<hr/>")}if($(c).append("<label>Энергетика</label>"),a.energeticForm.hasOwnProperty("cocoon")){var e="<b>Форма кокона:</b>&nbsp;"+a.energeticForm.cocoon;$(c).append("<p>"+e+"</p>")}if(a.energeticForm.kharicheskaya.length)for(var d in a.energeticForm.kharicheskaya){var e=a.energeticForm.kharicheskaya[d];$(c).append("<p>"+e+"</p>")}if(a.energeticForm.thin_levels.length)for(var d in a.energeticForm.thin_levels){var e=a.energeticForm.thin_levels[d];$(c).append("<p>"+e+"</p>")}if(a.energeticForm.hasOwnProperty("biofield")){var e=a.energeticForm.biofield.description;if($(c).append("<p><small>"+e+"</small></p>"),a.energeticForm.biofield.hasOwnProperty("cosmoearth")){var e=a.energeticForm.biofield.cosmoearth;$(c).append("<p>"+e+"</p>")}if(a.energeticForm.biofield.hasOwnProperty("native")){var e=a.energeticForm.biofield.native;$(c).append("<p>"+e+"</p>")}}if(a.confidenceForm.hasOwnProperty("inside")){$(c).append("<hr>"),$(c).append("<label>Уверенность</label>");var e=a.confidenceForm.inside.harmonic;if($(c).append("<p>"+e+"</p>"),a.confidenceForm.inside.hasOwnProperty("priority")){var e=a.confidenceForm.inside.priority;$(c).append("<p>"+e+"</p>")}}if(0===$(c).html().length&&$(c).append("<p>Результаты не были получены.</p>"),c="#Results #organism-part",$(c).empty(),a.organSystemsForm.length){$(c).append("<label>Системы организма</label>");var e="";for(var d in a.organSystemsForm)e+=a.organSystemsForm[d]+" ";$(c).append("<p>"+e+"</p>")}if(a.organsForm.length){$(c).append("<label>Внутренние органы</label>");for(var d in a.organsForm){var e=a.organsForm[d];$(c).append("<p>"+e+"</p>")}}0===$(c).html().length&&$(c).append("<p>Результаты не были получены.</p>"),Form.needValidate&&Form.isValid&&$("button#print").removeClass("disabled")},printResults:function(){window.print()}};Diagnostics.prototype={setChakraMain:function(a){this.chakraMain=a},setChakraSmall:function(a){this.chakraSmall=a},setEnergeticForm:function(a){this.energeticForm=a},setConfidenceForm:function(a){this.confidenceForm=a},setOrganSystemsForm:function(a){this.organSystemsForm=a},setOrgansForm:function(a){this.organsForm=a}};